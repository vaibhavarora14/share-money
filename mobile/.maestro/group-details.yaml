appId: com.sharemoney.app
---
# Test: Group Details
# This test verifies that a user can view group details after signing in
# Prerequisites: User must be signed in and have at least one group
# Note: App should be launched manually or already running before running this test

# Skip launchApp if app is already running - Maestro has issues with TCP forwarding timeout
# - launchApp
# Instead, we'll assume the app is already running or will be launched manually
- waitForAnimationToEnd

# Check if already signed in, if not sign in first
- runFlow:
    when:
      visible: "Welcome Back"
    commands:
      - tapOn:
          text: "Email"
      - inputText: "alice@test.com"
      - tapOn:
          text: "Password"
      - inputText: "testpassword123"
      - tapOn:
          text: "Sign In"
      - waitForAnimationToEnd

# Wait for groups list to load
- waitForAnimationToEnd
# The groups screen shows "Your Groups" as the main title
- assertVisible: "Your Groups"

# Wait for groups to load
- waitForAnimationToEnd

# Tap on a group by name
- tapOn:
    text: "Summer Vacation 2024"

# Wait for group details screen to load
- waitForAnimationToEnd

# Verify group details screen elements are visible
# The screen now uses segmented buttons to switch between Transactions and Activity views
- assertVisible:
    text: "Transactions"
- assertVisible:
    text: "Activity"

# Test switching to Activity tab
- tapOn:
    text: "Activity"
- waitForAnimationToEnd

# Switch back to Transactions tab
- tapOn:
    text: "Transactions"
- waitForAnimationToEnd

# Test accessing Members view via info icon (top right)
# The info icon button opens the members view
- tapOn:
    id: "info-icon-button"
    optional: true

# Wait for potential members view to load
- waitForAnimationToEnd

# Check if we're in members view - if so, navigate back to group details
# If not, we're still on group details (info icon didn't work or already closed)
- runFlow:
    when:
      visible: "Group Members"
    commands:
      # Members view is open - verify and navigate back
      - assertVisible:
          text: "Add Member"
          optional: true
      - tapOn:
          text: "Navigate back"
      - waitForAnimationToEnd

# At this point, we should be on group details screen
# Verify we're on group details (either we were already here, or we navigated back)
- assertVisible:
    text: "Transactions"

# Navigate back to groups list
- tapOn:
    text: "Navigate back"

# Wait for navigation
- waitForAnimationToEnd

# Verify we're back on groups list
- assertVisible: "Your Groups"

# Go to group details again to test Android native back button
- waitForAnimationToEnd
- tapOn:
    text: "Summer Vacation 2024"

# Wait for group details screen to load
- waitForAnimationToEnd

# Verify we're on group details screen again by checking segmented buttons
- assertVisible:
    text: "Transactions"

# Test Android native back button
- pressKey: "Back"

# Wait for navigation
- waitForAnimationToEnd

# Verify we're back on groups list
- assertVisible: "Your Groups"
